<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: board.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: board.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
MRAA - Low Level Skeleton Library for Communication on GNU/Linux platforms
Library in C/C++ to interface with Galileo &amp; other Intel platforms, in a structured and sane API with port nanmes/numbering that match boards &amp; with bindings to javascript &amp; python.

Steps for installing MRAA &amp; UPM Library on Intel IoT Platform with IoTDevKit Linux* image
Using a ssh client: 
1. echo "src maa-upm http://iotdk.intel.com/repos/1.1/intelgalactic" > /etc/opkg/intel-iotdk.conf
2. opkg update
3. opkg upgrade

Article: https://software.intel.com/en-us/html5/articles/intel-xdk-iot-edition-nodejs-templates
*/
var sensorStates = require('./conf/sensorStates');
var actuatorStates = require('./conf/actuatorStates');



/**
  * Board description
  * @namespace
  */
var board = function(mraa){
    
    var analogPin0;
    var currentSensorState;
    var currentActuatorState;
    var actuator;
    var actions = [];
    
    if(!mraa){        
        console.log('cannot initialize board, missing mraa');
        //return;
    }else{

        console.log('MRAA Version: ' + mraa.getVersion()); //write the mraa version to the Intel XDK console    
        setupLeds();
    }

    /** init function */
    function init(){
        if(mraa){
            loop();    
        }
        
    }
    

    /** loop */
    function loop() {
      Medir_Humedad();
      setTimeout(loop,3000); //call the indicated function after 1 second (1000 milliseconds)
    }    

    /** Medir Humedad */    
    function Medir_Humedad() {
        //humedad1 = analogRead(A5);
        //Serial.println(humedad1);
        var humedad = analogPin0.read(); //read the value of the analog pin
        
        console.log(humedad); //write the value of the analog pin to the console        
                        
        //var humedad = 400;
        
        for (var x in sensorStates){
            if( isInStateRange(humedad, sensorStates[x]) ){
                console.log(sensorStates[x].label);
                doAction(sensorStates[x].triggerAction, "auto");
            }
        }

    }
    
    /** doAction 
    * @param {actionType} triggerAction
    * @param {actionType} actionType
    */    
    function doAction(triggerAction, actionType){

        if(currentActuatorState != triggerAction){            
            if(mraa){
                actuator.write(actuatorStates[triggerAction].signal);    
            }
            
            currentActuatorState = triggerAction;
            saveAction(new Date().toLocaleString(), triggerAction, actionType);
        }

    }

    /** saveAction */    
    function saveAction(date, triggerAction, actionType){
         var action = { 
            action: triggerAction,
            date: date, 
            actionType: actionType 
        };
        actions.push(action);  
    }

    function getActions(){
        return actions;
    }
    
    function isInStateRange(humedad, state){
        return (humedad > state.lowerLimit &amp;&amp; humedad &lt; state.upperLimit);
    }

  
    function setupLeds(){
        var myOnboardLed = new mraa.Gpio(13); //LED hooked up to built in pin
        
        myOnboardLed.dir(mraa.DIR_OUT); //set the gpio direction to output
        
        actuator = new mraa.Gpio(4);
        actuator.dir(mraa.DIR_OUT);
        
        analogPin0 = new mraa.Aio(0); //setup access analog input Analog pin #0 (A0)

    }    
 
    function getActuatorState(){
        return currentActuatorState;
    }
    
    function prenderLed(){
        console.log('prendo led');
        myOnboardLed.write(1);
    }

    function apagarLed(){
        console.log('apago led');
        myOnboardLed.write(0);
    }
    
        
    return {
        apagarLed : apagarLed,
        prenderLed: prenderLed,
        getActuatorState: getActuatorState,
        doAction: doAction,
        init: init,
        getActions: getActions
    }
    
}


module.exports = board;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="board.html">board</a></li><li><a href="server.html">server</a></li><li><a href="storage.html">storage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Jun 24 2016 02:28:52 GMT-0300 (ART)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
