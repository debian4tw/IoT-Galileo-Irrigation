<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var http = require('http');

/**
  * Galileo server description. starts in config port
  * @namespace server
  */

 
var server = function(mocks, config){
  
    /**
    * Stores registered urls
    * @property {object} urls - contains action and mock if exists.
    */
    var urls = {};


    /**
     * Registers url and  callback to be matched.
     * @param {string} url - The url of the book.
     * @param {string} callback - The author of the book.
     * @param {string} mock - The author of the book.     
     */    
    function registerUrl(url, callback, mock){
        console.log('registering url' + url);
        //console.log('callback', callback());
        urls[url] = { 
            action : callback,
            mock: mock
        };
    }
    

    /** 
     * Returns server response 
     * @param {string} content - the content to be returned.
     */
    function response(content){
        return {
            success: true,
            date: new Date().toLocaleString(),
            content: content
        }
    }
    
    /** 
     * Returns error response 
     * @param {string} msg - the msg to be returned.
     */    
    function errorResponse(msg){
        return {
            success: false,
            date: new Date().toLocaleString(),
            content: msg
        }
    }
    
    /** 
     * Starts server 
     */    
    function startHttpServer(){
        var httpServer = http.createServer(function(req, res) {
            var content;
            console.log('requested url: ' + req.url);
             
            if(urls[req.url]){
                res.writeHead(200, {"Content-Type": "application/json"});
                
                if(config.mocksEnabled &amp;&amp; typeof mocks[req.url] != "undefined"){
                    content = mocks[req.url];
                    console.log("responded with mock for " + req.url);
                } else {
                    content = urls[req.url].action(req.url);
                }
                 
                res.end(JSON.stringify(content));
            
                /*if ( Object.keys(mocks).indexOf(req.url) > -1 ){
                //res.writeHead(200);
                var resp = JSON.stringify(mocks[req.url]);
                res.end(resp);*/
            } else{
                res.writeHead(200);
                res.end('&lt;h1>Not Found.&lt;/h1>');
                
            }


        });
        console.log('Starting http server in port ' + config.serverPort);
        httpServer.listen(config.serverPort);        
    }
    
    
    return {
        startHttpServer: startHttpServer,
        registerUrl : registerUrl,
        response: response
    }
    
    
    
};
    
module.exports = server;
   </code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="board.html">board</a></li><li><a href="server.html">server</a></li><li><a href="storage.html">storage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Jun 24 2016 02:28:52 GMT-0300 (ART)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
